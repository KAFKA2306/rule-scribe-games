import asyncio
import os
import sys

sys.path.append(os.getcwd())
from app.core import supabase

# Markdown Content for Batch 3

ICE_FALL_MD = """# ❄️ アイスフォール (Ice Fall / Crash Ice Game)

## 💎 ゲームの目的
ハンマーで氷を叩き落とそう！ただし、真ん中のペンギンを落としてはいけません。ハラハラドキドキのバランスゲームです。

## 📦 コンポーネント
- 氷のブロック（青・白）
- フィールド枠
- ペンギン（または動物）のコマ
- ハンマー
- ルーレット（さらにスリルを増す場合）

## 🔄 ゲームの流れ
1. **準備**: 枠の中に氷ブロックを敷き詰め、真ん中にペンギンを立てます。
2. **氷を叩く**: 純番にハンマーを持ち、ルーレット（または好きな決まり）に従って氷ブロックを叩き落とします。
    - 「白い氷を落とす」「青い氷を落とす」「パス」などの指示がある場合も。
3. **継続**: 氷が崩れないように慎重に叩きましょう。ペンギンが落ちなければセーフで、次の人の番になります。

## 🏆 勝利条件
誤って**ペンギンを落としてしまった人が負け**です。最後まで落とさなかった人の勝ち！

## 🛠 初心者向けヒント
- **力加減が大事**: 強く叩きすぎると周りの氷まで落ちてしまいます。コンコンと優しく叩きましょう。
- **相手を追い詰める**: 自分が生き残れるギリギリの場所を叩いて、次の人が困るように仕向けるのがコツです。
"""

YOKOHAMA_DUEL_MD = """# 🚢 横濱紳商伝デュエル (Yokohama Duel)

## 💎 ゲームの目的
明治時代の横浜で最高の商人を目指せ！2人対戦専用のワーカープレイスメントゲームです。部下を指揮して商品を仕入れ、注文をこなし、名声を競い合いましょう。

## 📦 コンポーネント
- エリアボード
- パワーカード（1〜4の数字）
- 商品チップ（銅、生糸、お茶、魚）
- 注文書カード

## 🔄 ゲームの流れ
全4ラウンドを競います。
1. **部下の配置**: 手札の「パワーカード」をボード上のエリア（港、研究所、教会など）に置きます。
    - カードの数字が大きいほど、強力なアクション（たくさん商品がもらえる等）ができます。
    - ただし、相手より強いパワーで置かないとアクションできない場合も！
2. **アクション実行**: 配置した場所の効果でお金や商品を獲得したり、注文書を達成したりします。
3. **成長**: ラウンド終了時、使ったカードを1枚「パワーアップ」させて、次のラウンドでより強くすることができます。

## 🏆 勝利条件
4ラウンド終了後、最も**勝利点**が高いプレイヤーの勝利です。
- 達成した注文書
- 建てた店舗や商館
- 教会や税関への貢献度
などが点数になります。

## 🛠 初心者向けヒント
- **相手の邪魔をする**: 相手が欲しそうなエリアに先にパワーカードを置いてブロックしたり、高いパワーで圧倒したりする駆け引きが熱いです。
- **注文書のバランス**: 商品を集めるだけでなく、効率よく注文書に変えて点数を稼ぐリズムが大切です。
"""

ISTANBUL_MD = """# 🕌 イスタンブール (Istanbul)

## 💎 ゲームの目的
イスタンブールのバザーは大賑わい！商人となって、誰よりも早く5つの「ルビー」を集めましょう。
ただし、自分一人では何もできません。4人の「助手」を適切な場所に配置し、効率よく商品を売買するルート作りが勝利のカギです。

## 📦 コンポーネント
- 16枚の場所タイル（4×4のマップになります）
- 商人コマと助手コマ
- 手押し車（荷台）
- 特産品（スパイス、果物など）とルビー

## 🔄 ゲームの流れ
自分の番には、商人コマ（助手とスタックしたもの）を1〜2歩移動させます。
1. **助手の配置／回収**:
   - 移動先に自分の助手が**いない**場合：助手を1人残して（置いて）アクションを行います。
   - 移動先に自分の助手が**いる**場合：その助手を回収（スタックに戻す）してアクションを行います。
   - **重要**: 助手が全員出払ってしまうと、回収するまでアクションができなくなります！
2. **場所アクション**:
   - 市場で商品を売ってお金にする、問屋で手押し車を拡張する、宝石商でルビーを買うなど、タイルごとに様々な効果があります。
3. **他プレイヤーとの遭遇**:
   - 他の商人がいる場所に止まると、その人に2金を支払わなければなりません（痛い出費です！）。

## 🏆 勝利条件
誰かが規定数（通常は5個）のルビーを集めたら、そのラウンドでゲーム終了です。ルビーが最も多い人が、バザーの支配者として勝利します！

## 🛠 初心者向けヒント
- **ルート計画が命**: 「行って帰ってくる」動きで助手を回収するのが基本です。一筆書きのように無駄なく動く計画を立てましょう。
- **噴水を利用せよ**: マップ中央などにある「噴水」に行けば、散らばった助手を一瞬で全員呼び戻せます。
- **手押し車の拡張**: 一度に持てる商品が増えると、効率が劇的に上がります。早めに拡張するのも手です。
"""

UPDATES = {
    "ice-fall": ICE_FALL_MD,
    "yokohama-duel": YOKOHAMA_DUEL_MD,
    "istanbul": ISTANBUL_MD,
}


def update_rules():
    print("Updating Batch 3 games...")
    for slug, content in UPDATES.items():
        try:
            res = (
                supabase._client.table("games")
                .update({"rules_content": content})
                .eq("slug", slug)
                .execute()
            )
            if res.data:
                print(f"✅ {slug} updated")
            else:
                print(f"⚠️ {slug}: No data returned (Verify slug)")
        except Exception as e:
            print(f"❌ {slug}: {e}")


if __name__ == "__main__":
    update_rules()
