# ãƒœãƒ‰ã‚²ã®ãƒŸã‚«ã‚¿ (Bodoge no Mikata) - å®Œå…¨çµ±åˆãƒã‚¹ã‚¿ãƒ¼ã‚¬ã‚¤ãƒ‰

> **é‡è¦ãªå…è²¬äº‹é …**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**å”¯ä¸€ã®çœŸå®Ÿï¼ˆSingle Source of Truthï¼‰**ã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚„è¨­å®šã«é–¢ã™ã‚‹ç–‘å•ãŒç”Ÿã˜ãŸå ´åˆã€ã¾ãšã“ã“ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€Œæˆ¦ç•¥ã€ã€Œãƒ­ã‚¸ãƒƒã‚¯ã€ã€Œè¨­å®šã€ã€Œã‚¹ã‚­ãƒ¼ãƒã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã€ã€Œã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã€ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ã®ã™ã¹ã¦ã‚’ç¶²ç¾…ã—ã¦ã„ã¾ã™ã€‚

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ†²ç«  (Project Charter)

### 1.1 ã‚µãƒ¼ãƒ“ã‚¹å
*   **æ—¥æœ¬èª**: ãƒœãƒ‰ã‚²ã®ãƒŸã‚«ã‚¿
*   **è‹±èª (Repo)**: Bodoge no Mikata
*   **ç•¥ç§°**: Bodoge no Mikata

### 1.2 ã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆ & å“²å­¦ (Core Concepts & Philosophy)

1.  **Living Wiki (ç”Ÿãã¦ã„ã‚‹Wiki)**
    *   é™çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ŒçŸ¥ã‚‰ãªã„ã‚²ãƒ¼ãƒ ã€ã‚’æ¤œç´¢ã—ãŸç¬é–“ã€AIãŒä¸–ç•Œä¸­ã‹ã‚‰æƒ…å ±ã‚’åé›†ã—ã€Wikiãƒšãƒ¼ã‚¸ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç”Ÿæˆã—ã¾ã™ã€‚
    *   **è‡ªå·±é€²åŒ–**: æ¤œç´¢ã•ã‚Œã‚‹ãŸã³ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæˆé•·ã—ã€æ¬¡å›ä»¥é™ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã®æ©æµï¼ˆé«˜é€Ÿè¡¨ç¤ºï¼‰ã‚’å—ã‘ã¾ã™ã€‚

2.  **Minimal Code & High Speed (æœ€å°ã‚³ãƒ¼ãƒ‰ãƒ»æœ€é«˜é€Ÿåº¦)**
    *   **"No Boilerplate"**: ä¸è¦ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆè¤‡é›‘ãªORMãƒ©ãƒƒãƒ‘ãƒ¼ã€éå‰°ãªæŠ½è±¡åŒ–ï¼‰ã‚’æ’é™¤ã—ã¾ã™ã€‚
    *   **Direct & Raw**: Supabaseã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¡ã€AIã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚‚ç›´æ„Ÿçš„ã§ã™ã€‚

3.  **Modern & Cool UI (ãƒ¢ãƒ€ãƒ³ã§ã‚¯ãƒ¼ãƒ«ãªUI)**
    *   **Neon Accents**: `Zen Maru Gothic` (ä¸¸ã‚´ã‚·ãƒƒã‚¯) ã¨ `Space Grotesk` ã‚’çµ„ã¿åˆã‚ã›ã€æœªæ¥çš„ã‹ã¤è¦ªã—ã¿ã‚„ã™ã„å°è±¡ã€‚
    *   **User Centric**: å°‚é–€ç”¨èªã‚’é¿ã‘ã€ã€Œã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ã€Œå‹ã¡æ–¹ã€ãªã©ã€åˆå¿ƒè€…ãŒçŸ¥ã‚ŠãŸã„æƒ…å ±ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¾ã™ã€‚

### 1.3 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
*   **ã‚¤ãƒ³ã‚¹ãƒˆæ™‚é–“ã‚’çŸ­ç¸®ã—ãŸã„ã‚²ãƒ¼ãƒãƒ¼**: èª¬æ˜æ›¸ã‚’èª­ã‚€ã®ãŒè‹¦æ‰‹ã€ã¾ãŸã¯æ™‚é–“ãŒãªã„äººã€‚
*   **è¼¸å…¥ã‚²ãƒ¼ãƒ æ„›å¥½å®¶**: è‹±èªã‚„ãƒ‰ã‚¤ãƒ„èªã®ãƒ«ãƒ¼ãƒ«ãƒ–ãƒƒã‚¯ã—ã‹æ‰‹å…ƒã«ãªãã€æ—¥æœ¬èªã®è¦ç´„ãŒæ¬²ã—ã„äººã€‚
*   **ãƒ—ãƒ¬ã‚¤ä¸­ã®ç¢ºèª**: ã€Œã“ã®ã‚«ãƒ¼ãƒ‰ã®åŠ¹æœãªã‚“ã ã£ã‘ï¼Ÿã€ã‚’ç¬æ™‚ã«è§£æ±ºã—ãŸã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€‚

---

## 2. æˆ¦ç•¥: Core vs Experiments (Strategy)

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**ã€Œæœ¬ç•ªã®å …ç‰¢æ€§ã€**ã¨**ã€Œå®Ÿé¨“ã®è‡ªç”±åº¦ã€**ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã«ã€æ˜ç¢ºãªäºŒå±¤æ§‹é€ ã‚’æ¡ç”¨ã—ã¾ã™ã€‚

### 2.1 æ–¹é‡ (Policy)
> **æœ¬ç•ª (Core) ã¯æœ€å°ãƒ»å®‰å®šæ§‹æˆã«å›ºå®šã€‚**
> **å®Ÿé¨“ (Experiments) ã¯å®Œå…¨ã«æ¨ªã«åˆ†é›¢ã€‚**

### 2.2 ğŸ› ä¸Šå±¤ï¼šCORE (æœ¬ç•ª OS)
*ä¿¡é ¼ã§ãã‚‹ä¸€æœ¬ç·š*

*   **Endpoint**: `/api/search`, `/api/games`
*   **Logic**: Supabase æ¤œç´¢ OR (Gemini 1-shot ç”Ÿæˆ -> Upsert)
*   **GeminiClient**: 1-shot JSON å°‚ç”¨ã€‚CrewAI ç¦æ­¢ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ `prompts.yaml` ã§ä¸€å…ƒç®¡ç†ã€‚
*   **DataEnhancer**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ãƒªãƒ³ã‚¯æ¤œè¨¼ãƒ»æ›´æ–°ã‚’å®Ÿè¡Œã€‚
*   **Frontend**: `/api/*` ã®ã¿ã‚’å©ãã€‚
*   **ç‰¹å¾´**: å£Šã‚Œãªã„ã€æ˜ç­ã€ä¿å®ˆã—ã‚„ã™ã„ã€‚

### 2.3 ğŸ§ª ä¸‹å±¤ï¼šEXPERIMENTS (å®Ÿé¨“ãƒ¬ã‚¤ãƒ¤ãƒ¼)
*è‡ªç”±ã«å£Šã—ã¦ã„ã„å ´æ‰€*

*   **Location**: `backend/experiments/`
*   **Files**: `crew_agentic_demo.py` ãªã©
*   **Access**: Supabase ã‚’ç›´æ¥å©ã (API çµŒç”±ã§ã¯ãªã„)
*   **Execution**: ãƒ­ãƒ¼ã‚«ãƒ« (`uv run python experiments/xxx.py`)
*   **æ˜‡æ ¼ãƒ«ãƒ¼ãƒ«**: ã€Œä½•åº¦ã‚‚ä½¿ã†ã»ã©ä¾¿åˆ©ã€ã¨ç¢ºä¿¡ã§ããŸæ©Ÿèƒ½ã®ã¿ã€æ…é‡ã« API åŒ–ã—ã¦ Core ã«çµ±åˆã€‚

---

## 3. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (System Architecture)

### 3.1 å…¨ä½“æ§‹æˆå›³ (Overview Diagram)
```mermaid
graph TD
    subgraph Client [User Environment]
        Browser[Web Browser]
    end

    subgraph Vercel [Vercel Platform]
        CDN[Edge Network / CDN]
        FE[Static Frontend (React/Vite)]
        BE[Serverless Function (Python/FastAPI)]
    end

    subgraph External [External Services]
        Supabase[(Supabase PostgreSQL)]
        Gemini[Google Gemini 2.5 Flash]
    end

    Browser --> |HTTPS| CDN
    CDN --> |/| FE
    CDN --> |/api/*| BE

    BE --> |Read/Write| Supabase
    BE --> |Generate| Gemini
    BE -.-> |Background| DataEnhancer[Data Enhancer]
    DataEnhancer --> |Verify| Internet[World Wide Web]
    Gemini --> |Grounding (Search)| Internet
```

### 3.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ (Detailed File Manifest)
*   `backend/init_db.sql`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã¨ãƒˆãƒªã‚¬ãƒ¼å®šç¾©ã€‚
*   `backend/app/main.py`: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã€‚
*   `backend/app/core/settings.py`: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ã€‚
*   `backend/app/core/prompts.py`: `prompts_data.py` ãƒ­ãƒ¼ãƒ€ãƒ¼ã€‚
*   `backend/app/core/prompts_data.py`: å…¨AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šç¾© (Python Dictionary)ã€‚
*   `backend/app/services/gemini_client.py`: æ¤œç´¢ã¨åŸºæœ¬æƒ…å ±æŠ½å‡ºã®AIãƒ­ã‚¸ãƒƒã‚¯ (1-shot)ã€‚Amazonãƒªãƒ³ã‚¯æ³¨å…¥å«ã‚€ã€‚
*   `backend/app/services/data_enhancer.py`: ãƒªãƒ³ã‚¯æ¤œè¨¼ãƒ»è‡ªå‹•æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ (Background Task)ã€‚
*   `backend/app/routers/games.py`: ã‚²ãƒ¼ãƒ ä¸€è¦§ãƒ»è©³ç´°å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (DataEnhancerçµ±åˆæ¸ˆã¿)ã€‚
*   `backend/app/routers/search.py`: æ¤œç´¢ãƒ»ç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚
*   `backend/app/services/amazon_affiliate.py`: Amazonæ¤œç´¢URLç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã€‚
*   `backend/app/models.py`: å…±æœ‰Pydanticãƒ¢ãƒ‡ãƒ«å®šç¾©ã€‚
*   `backend/experiments/`: å®Ÿé¨“ç”¨ã‚³ãƒ¼ãƒ‰ç½®ãå ´ (CrewAIãªã©)ã€‚
*   `frontend/src/index.css`: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ã¨ã‚«ãƒ©ãƒ¼å¤‰æ•°å®šç¾©ã€‚
*   `vercel.json`: ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã€‚
*   `frontend/vite.config.js`: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ãƒ»é–‹ç™ºãƒ—ãƒ­ã‚­ã‚·è¨­å®šã€‚

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è©³ç´° (Database Schema)

**Platform**: Supabase (PostgreSQL)

### 4.1 ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾© (`games`)
`backend/init_db.sql` ã«åŸºã¥ãç¾åœ¨ã®å®šç¾©ã§ã™ã€‚

```sql
-- pgvectoræ‹¡å¼µ (å°†æ¥çš„ãªãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ç”¨)
create extension if not exists vector;

create table if not exists games (
  id uuid primary key default gen_random_uuid(), -- UUID
  slug text unique,                 -- URLç”¨ã‚¹ãƒ©ãƒƒã‚°
  title text not null,              -- ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ« (æ—¥/è‹±)
  description text,                 -- çŸ­ã„æ¦‚è¦
  summary text,                     -- AIç”Ÿæˆè¦ç´„
  rules_content text,               -- è©³ç´°ãƒ«ãƒ¼ãƒ« (Markdown)
  rules jsonb default '{}'::jsonb,  -- æ§‹é€ åŒ–ãƒ«ãƒ¼ãƒ« (Legacy)
  source_url text,                  -- æƒ…å ±æºURL
  image_url text,                   -- ç”»åƒURL
  structured_data jsonb,            -- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
  
  -- Analytics & Logic
  view_count bigint default 0,      -- é–²è¦§æ•°
  search_count bigint default 0,    -- æ¤œç´¢ãƒ’ãƒƒãƒˆæ•°
  data_version integer default 0,   -- ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µãƒãƒ¼ã‚¸ãƒ§ãƒ³
  is_official boolean default false,-- å…¬å¼/æ¤œè¨¼æ¸ˆã¿ãƒ•ãƒ©ã‚°

  -- Metadata
  min_players integer,
  max_players integer,
  play_time integer,
  min_age integer,
  published_year integer,

  -- Titles
  title_ja text,
  title_en text,

  -- External Links
  official_url text,
  bgg_url text,
  bga_url text,
  amazon_url text,

  -- Media
  audio_url text,

  created_at timestamp with time zone default now() not null,
  updated_at timestamp with time zone default now() not null
);

create index if not exists idx_games_slug on games(slug);
create index if not exists idx_games_title on games(title);
```

### 4.2 ãƒˆãƒªã‚¬ãƒ¼ (Triggers)
`extensions.moddatetime` ã‚’ä½¿ç”¨ã—ã¦ä¿¡é ¼æ€§ã®é«˜ã„æ›´æ–°æ—¥æ™‚ç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚

---

## 5. è¨­å®šå€¤ãƒ»ç’°å¢ƒå¤‰æ•° (Settings & Configurations)

### 5.1 ç’°å¢ƒå¤‰æ•° (`backend/app/core/settings.py`)
ã‚·ã‚¹ãƒ†ãƒ ãŒä¾å­˜ã™ã‚‹å…¨ã¦ã®ç’°å¢ƒå¤‰æ•°ã§ã™ã€‚

| å¤‰æ•°å | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
| :--- | :--- | :--- |
| `GEMINI_API_KEY` | `None` (Required) | Google AI Studio APIã‚­ãƒ¼ã€‚ |
| `GEMINI_MODEL` | `models/gemini-2.5-flash` | ä½¿ç”¨ã™ã‚‹AIãƒ¢ãƒ‡ãƒ«åã€‚ |
| `SUPABASE_URL` | `None` (Required) | Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURLã€‚ |
| `SUPABASE_KEY` | `None` (Required) | Supabase APIã‚­ãƒ¼ã€‚ |
| `AMAZON_TRACKING_ID` | `None` | Amazonã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°IDã€‚ |

### 5.2 å®šæ•°å€¤ (Hardcoded Constants)
*   `gemini_client.py`: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ `60.0` ç§’ã€‚
*   `search.py`: "Simple Search" åˆ¤å®šã®æ–‡å­—æ•°åˆ¶é™ `50` æ–‡å­—ã€‚
*   `data_enhancer.py`: ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ `30` æ—¥, æ¤œè¨¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ `30.0` ç§’ã€‚

---

## 6. AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¨é›† (Prompt Registry)

ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ `backend/app/core/prompts_data.py` ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚

### 6.1 æ–°è¦æ¤œç´¢ãƒ»åŸºæœ¬æƒ…å ±æŠ½å‡º (`gemini_client.extract_game_info`)
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’æ¤œç´¢ã—ãŸéš›ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚å³å¯†ãªäº‹å®Ÿã«åŸºã¥ãã€ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’å›é¿ã™ã‚‹ã‚ˆã†æŒ‡ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

### 6.2 ãƒªãƒ³ã‚¯æ¤œè¨¼ãƒ»æ›´æ–° (`data_enhancer.find_valid_links`)
`DataEnhancer` ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚‹éš›ã€å…¬å¼URLã€Amazon URLã€ç”»åƒURLã®å€™è£œã‚’æ¢ã™ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

---

## 7. APIä»•æ§˜æ›¸ (API Specification)

ã™ã¹ã¦ã®APIã¯ `FastAPI` ã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã€`/api` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’æŒã¡ã¾ã™ã€‚

### 7.1 POST `/api/search`
æ¤œç´¢ã¨ç”Ÿæˆã®ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**Request**:
```json
{
  "query": "ã‚«ã‚¿ãƒ³"
}
```

**Response (SearchResult)**:
```json
{
  "id": "a0eebc99...",
  "slug": "catan",
  "title": "Catan (ã‚«ã‚¿ãƒ³)",
  "description": "...",
  "rules_content": "...",
  "structured_data": { ... }
}
```

### 7.2 GET `/api/games`
æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸã‚²ãƒ¼ãƒ ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

### 7.3 GET `/api/games/{slug}`
ç‰¹å®šã®ã‚²ãƒ¼ãƒ è©³ç´°ã‚’å–å¾—ã€‚Slug ã¾ãŸã¯ ID ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚
**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†**: `DataEnhancer` ãŒèµ·å‹•ã—ã€ãƒªãƒ³ã‚¯æƒ…å ±ã®æ¤œè¨¼ã¨æ›´æ–°ã‚’éåŒæœŸã§è©¦ã¿ã¾ã™ã€‚

---

## 8. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è©³ç´° (Frontend Details)

**Framework**: React 18 + Vite
**Styling**: CSS Modules (Variables) + Utility Classes

### 8.1 ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ  (Design System)
`frontend/src/index.css` ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ç¾åœ¨ã®CSSå¤‰æ•°ã§ã™ã€‚

```css
:root {
  --bg-dark: #0b1221;
  --bg-card: rgba(255, 255, 255, 0.05);
  --accent: #4ef0c7;
  --text-main: #eef2ff;
  --font-main: 'Zen Maru Gothic', sans-serif;
  --font-head: 'Space Grotesk', sans-serif;
}
```

---

## 9. é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰ (Development & Deployment)

### 9.1 ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰

**ä¾å­˜é–¢ä¿‚ (Dependencies)**:
*   **Backend**: `fastapi`, `google-generativeai`, `supabase`, `httpx`, `PyYAML`
*   **Frontend**: `react`, `react-markdown`

**ã‚³ãƒãƒ³ãƒ‰ (Taskfile)**:
*   `task dev`: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹• (Backend + Frontend)
*   `task lint`: Lint & Format

### 9.2 å®Ÿé¨“çš„æ©Ÿèƒ½ã®é–‹ç™º (Experiments)
CrewAIãªã©ã®æ–°ã—ã„AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è©¦ã™å ´åˆã¯ã€å¿…ãš `backend/experiments/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§é–‹ç™ºã—ã¦ãã ã•ã„ã€‚
`backend/app/` å†…ã®ã‚³ãƒ¼ãƒ‰ã¯æœ¬ç•ªç”¨ã§ã‚ã‚Šã€å®Ÿé¨“çš„ãªä¾å­˜é–¢ä¿‚ã‚’å«ã‚ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

### 9.3 ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ (Coding Standards)
*   **KISS**: ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¤ã€‚
*   **No Comments**: ã‚³ãƒ¼ãƒ‰ã§èªã‚‹ã€‚
*   **Japanese Content**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ†ã‚­ã‚¹ãƒˆã¯æ—¥æœ¬èªã€‚
*   **Type Hints**: Pythonã‚³ãƒ¼ãƒ‰ã«ã¯å‹ãƒ’ãƒ³ãƒˆã‚’å¿…é ˆã¨ã™ã‚‹ã€‚
*   **Prompts in Python**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ `prompts_data.py` ã«è¨˜è¿°ã™ã‚‹ (Verceläº’æ›æ€§ã®ãŸã‚)ã€‚

---

## 10. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° (Troubleshooting)

### 10.1 Vercelç’°å¢ƒå¤‰æ•°
`echo -n` ã‚’ä½¿ç”¨ã—ã¦æ”¹è¡Œã‚’å«ã‚ãšã«è¨­å®šã™ã‚‹ã“ã¨ã€‚

### 10.2 IDã®å‹å®šç¾©
Supabaseã®IDã¯ **UUID (str)** ã§ã™ã€‚`int` ã¨ã—ã¦æ‰±ã‚ãªã„ã“ã¨ã€‚

### 10.3 Supabase Upsert
å¿…ãšãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ã§ã‚«ãƒ©ãƒ ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã‹ã‚‰ `upsert` ã™ã‚‹ã“ã¨ã€‚AIãŒç”Ÿæˆã—ãŸä½™åˆ†ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

---

## 11. ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ  (Affiliate System)

### 11.1 è‡ªå‹•æ¤œç´¢ãƒªãƒ³ã‚¯ (Layer 0)
*   **ãƒ­ã‚¸ãƒƒã‚¯**: `https://www.amazon.co.jp/s?k={Title}&tag={TrackingID}` ã‚’è‡ªå‹•ç”Ÿæˆã€‚
*   **å®Ÿè£…**: `backend/app/services/amazon_affiliate.py`
*   **å„ªå…ˆé †ä½**: `structured_data` ã«æ˜ç¤ºçš„ãªãƒªãƒ³ã‚¯ãŒãªã„å ´åˆã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚

### 11.2 æ¤œè¨¼æ¸ˆã¿ãƒªãƒ³ã‚¯ (Layer 1 - DataEnhancer)
*   **ãƒ­ã‚¸ãƒƒã‚¯**: `DataEnhancer` ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ‰åŠ¹ãªAmazonå•†å“ãƒšãƒ¼ã‚¸URLã‚’ç‰¹å®šã—ã€DBã«ä¿å­˜ã€‚
*   **å®Ÿè£…**: `backend/app/services/data_enhancer.py`
*   **å„ªå…ˆé †ä½**: æœ€å„ªå…ˆã€‚DBã« `amazon_url` ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€‚

---

ã“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å‚è€ƒã«ã—ã¦ã€ã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤é«˜é€Ÿãªã€Œãƒœãƒ‰ã‚²ã®ãƒŸã‚«ã‚¿ã€ã‚’é–‹ç™ºã—ç¶šã‘ã¾ã—ã‚‡ã†ã€‚

---

## 12. SEO & Verification

### 12.1 Google Search Console Verification
*   **Method**: HTML File Upload
*   **File**: `frontend/public/google0e9954154a369dd5.html`
*   **Content**: `google-site-verification: google0e9954154a369dd5.html`
*   **Purpose**: Google Search Console ã®æ‰€æœ‰æ¨©ç¢ºèªç”¨ã€‚

### 12.2 Meta Tags & Indexability
*   **Robots Meta Tag**: `frontend/index.html` ã« `<meta name="robots" content="index, follow" />` ã‚’é…ç½®ã—ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨±å¯ã€‚
*   **Dynamic Meta Tags**: `react-helmet-async` ã‚’ä½¿ç”¨ã—ã¦ã€å„ã‚²ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ (`GamePage.jsx`) ã§å‹•çš„ã« `<title>`, `<meta name="description">`, OGPã‚¿ã‚°ã‚’ç”Ÿæˆã€‚
*   **Canonical URL**: é‡è¤‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é˜²æ­¢ã®ãŸã‚ã€æ­£è¦åŒ–URLã‚’è¨­å®šã€‚

### 12.3 Sitemap & Robots.txt
*   **Sitemap**: `frontend/public/sitemap.xml` (æ‰‹å‹•/é™çš„é…ç½®)
*   **Robots.txt**: `frontend/public/robots.txt`
