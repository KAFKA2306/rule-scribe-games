# ãƒœãƒ‰ã‚²ã®ãƒŸã‚«ã‚¿ (Bodoge no Mikata) - å®Œå…¨çµ±åˆãƒã‚¹ã‚¿ãƒ¼ã‚¬ã‚¤ãƒ‰

> **é‡è¦ãªå…è²¬äº‹é …**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**å”¯ä¸€ã®çœŸå®Ÿï¼ˆSingle Source of Truthï¼‰**ã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚„è¨­å®šã«é–¢ã™ã‚‹ç–‘å•ãŒç”Ÿã˜ãŸå ´åˆã€ã¾ãšã“ã“ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€Œæˆ¦ç•¥ã€ã€Œãƒ­ã‚¸ãƒƒã‚¯ã€ã€Œè¨­å®šã€ã€Œã‚¹ã‚­ãƒ¼ãƒã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã€ã€Œã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã€ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ã®ã™ã¹ã¦ã‚’ç¶²ç¾…ã—ã¦ã„ã¾ã™ã€‚

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ†²ç«  (Project Charter)

### 1.1 ã‚µãƒ¼ãƒ“ã‚¹å
*   **æ—¥æœ¬èª**: ãƒœãƒ‰ã‚²ã®ãƒŸã‚«ã‚¿
*   **è‹±èª (Repo)**: Bodoge no Mikata
*   **ç•¥ç§°**: Bodoge no Mikata

### 1.2 ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚»ãƒ—ãƒˆå®šç¾© (System Concept Definition)

1.  **Living Wiki (ç”Ÿãã¦ã„ã‚‹Wiki)**
    *   é™çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ŒçŸ¥ã‚‰ãªã„ã‚²ãƒ¼ãƒ ã€ã‚’æ¤œç´¢ã—ãŸç¬é–“ã€AIãŒä¸–ç•Œä¸­ã‹ã‚‰æƒ…å ±ã‚’åé›†ã—ã€Wikiãƒšãƒ¼ã‚¸ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç”Ÿæˆã—ã¾ã™ã€‚
    *   **è‡ªå·±é€²åŒ–**: æ¤œç´¢ã•ã‚Œã‚‹ãŸã³ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæˆé•·ã—ã€æ¬¡å›ä»¥é™ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã®æ©æµï¼ˆé«˜é€Ÿè¡¨ç¤ºï¼‰ã‚’å—ã‘ã¾ã™ã€‚

2.  **Minimal Code & High Speed (æœ€å°ã‚³ãƒ¼ãƒ‰ãƒ»æœ€é«˜é€Ÿåº¦)**
    *   **"No Boilerplate"**: ä¸è¦ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆè¤‡é›‘ãªORMãƒ©ãƒƒãƒ‘ãƒ¼ã€éå‰°ãªæŠ½è±¡åŒ–ï¼‰ã‚’æ’é™¤ã—ã¾ã™ã€‚
    *   **Direct & Raw**: Supabaseã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¡ã€AIã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚‚ç›´æ„Ÿçš„ã§ã™ã€‚

3.  **Modern & Cool UI (ãƒ¢ãƒ€ãƒ³ã§ã‚¯ãƒ¼ãƒ«ãªUI)**
    *   **Neon Accents**: `Zen Maru Gothic` (ä¸¸ã‚´ã‚·ãƒƒã‚¯) ã¨ `Space Grotesk` ã‚’çµ„ã¿åˆã‚ã›ã€æœªæ¥çš„ã‹ã¤è¦ªã—ã¿ã‚„ã™ã„å°è±¡ã€‚
    *   **User Centric**: å°‚é–€ç”¨èªã‚’é¿ã‘ã€ã€Œã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ã€Œå‹ã¡æ–¹ã€ãªã©ã€åˆå¿ƒè€…ãŒçŸ¥ã‚ŠãŸã„æƒ…å ±ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¾ã™ã€‚

### 1.3 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
*   **ã‚¤ãƒ³ã‚¹ãƒˆæ™‚é–“ã‚’çŸ­ç¸®ã—ãŸã„ã‚²ãƒ¼ãƒãƒ¼**: èª¬æ˜æ›¸ã‚’èª­ã‚€ã®ãŒè‹¦æ‰‹ã€ã¾ãŸã¯æ™‚é–“ãŒãªã„äººã€‚
*   **è¼¸å…¥ã‚²ãƒ¼ãƒ æ„›å¥½å®¶**: è‹±èªã‚„ãƒ‰ã‚¤ãƒ„èªã®ãƒ«ãƒ¼ãƒ«ãƒ–ãƒƒã‚¯ã—ã‹æ‰‹å…ƒã«ãªãã€æ—¥æœ¬èªã®è¦ç´„ãŒæ¬²ã—ã„äººã€‚
*   **ãƒ—ãƒ¬ã‚¤ä¸­ã®ç¢ºèª**: ã€Œã“ã®ã‚«ãƒ¼ãƒ‰ã®åŠ¹æœãªã‚“ã ã£ã‘ï¼Ÿã€ã‚’ç¬æ™‚ã«è§£æ±ºã—ãŸã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€‚

---

## 2. é–‹ç™ºæ–¹é‡ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ (Development Policy & Architecture Pattern)

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**ã€Œæœ¬ç•ªã®å …ç‰¢æ€§ã€**ã¨**ã€Œå®Ÿé¨“ã®è‡ªç”±åº¦ã€**ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã«ã€æ˜ç¢ºãªäºŒå±¤æ§‹é€ ã‚’æ¡ç”¨ã—ã¾ã™ã€‚

### 2.1 æ–¹é‡ (Policy)
> **æœ¬ç•ª (Core) ã¯æœ€å°ãƒ»å®‰å®šæ§‹æˆã«å›ºå®šã€‚**
> **å®Ÿé¨“ (Experiments) ã¯å®Œå…¨ã«æ¨ªã«åˆ†é›¢ã€‚**

### 2.2 ğŸ› ä¸Šå±¤ï¼šCORE (æœ¬ç•ª OS)
*ä¿¡é ¼ã§ãã‚‹ä¸€æœ¬ç·š*

*   **Endpoint**: `/api/search`, `/api/games`
*   **Logic**: Supabase æ¤œç´¢ OR (Gemini 1-shot ç”Ÿæˆ -> Upsert)
*   **GeminiClient**: 1-shot JSON å°‚ç”¨ã€‚CrewAI ç¦æ­¢ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ `prompts.yaml` ã§ä¸€å…ƒç®¡ç†ã€‚
*   **DataEnhancer**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ãƒªãƒ³ã‚¯æ¤œè¨¼ãƒ»æ›´æ–°ã‚’å®Ÿè¡Œã€‚
*   **Frontend**: `/api/*` ã®ã¿ã‚’å©ãã€‚
*   **ç‰¹å¾´**: å£Šã‚Œãªã„ã€æ˜ç­ã€ä¿å®ˆã—ã‚„ã™ã„ã€‚

### 2.3 ğŸ§ª ä¸‹å±¤ï¼šEXPERIMENTS (å®Ÿé¨“ãƒ¬ã‚¤ãƒ¤ãƒ¼)
*è‡ªç”±ã«å£Šã—ã¦ã„ã„å ´æ‰€*

*   **Location**: `backend/experiments/`
*   **Files**: `crew_agentic_demo.py` ãªã©
*   **Access**: Supabase ã‚’ç›´æ¥å©ã (API çµŒç”±ã§ã¯ãªã„)
*   **Execution**: ãƒ­ãƒ¼ã‚«ãƒ« (`uv run python experiments/xxx.py`)
*   **æ˜‡æ ¼ãƒ«ãƒ¼ãƒ«**: ã€Œä½•åº¦ã‚‚ä½¿ã†ã»ã©ä¾¿åˆ©ã€ã¨ç¢ºä¿¡ã§ããŸæ©Ÿèƒ½ã®ã¿ã€æ…é‡ã« API åŒ–ã—ã¦ Core ã«çµ±åˆã€‚

---

## 3. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ (System Configuration)

### 3.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ (System Configuration Diagram)
```mermaid
graph TD
    subgraph Client ["User Environment"]
        Browser["Web Browser"]
    end

    subgraph Vercel ["Vercel Platform"]
        CDN["Edge Network / CDN"]
        FE["Static Frontend (React/Vite)"]
        BE["Serverless Function (Python/FastAPI)"]
    end

    subgraph External ["External Services"]
        Supabase[("Supabase PostgreSQL")]
        Gemini["Google Gemini 2.5 Flash"]
    end

    Browser --> |HTTPS| CDN
    CDN --> |/| FE
    CDN --> |/api/*| BE

    BE --> |Read/Write| Supabase
    BE --> |Generate| Gemini
    BE -.-> |Background| DataEnhancer["Data Enhancer"]
    DataEnhancer --> |Verify| Internet["World Wide Web"]
```

### 3.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ (Detailed File Manifest)
*   `backend/init_db.sql`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã¨ãƒˆãƒªã‚¬ãƒ¼å®šç¾©ã€‚
*   `backend/app/main.py`: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã€‚
*   `backend/app/core/settings.py`: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ã€‚
*   `backend/app/core/prompts.py`: `prompts_data.py` ãƒ­ãƒ¼ãƒ€ãƒ¼ã€‚
*   `backend/app/core/prompts_data.py`: å…¨AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šç¾© (Python Dictionary)ã€‚
*   `backend/app/services/gemini_client.py`: æ¤œç´¢ã¨åŸºæœ¬æƒ…å ±æŠ½å‡ºã®AIãƒ­ã‚¸ãƒƒã‚¯ (1-shot)ã€‚Amazonãƒªãƒ³ã‚¯æ³¨å…¥å«ã‚€ã€‚
*   `backend/app/services/data_enhancer.py`: ãƒªãƒ³ã‚¯æ¤œè¨¼ãƒ»è‡ªå‹•æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ (Background Task)ã€‚
*   `backend/app/routers/games.py`: ã‚²ãƒ¼ãƒ ä¸€è¦§ãƒ»è©³ç´°å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (DataEnhancerçµ±åˆæ¸ˆã¿)ã€‚
*   `backend/app/routers/search.py`: æ¤œç´¢ãƒ»ç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚
*   `backend/app/services/amazon_affiliate.py`: Amazonæ¤œç´¢URLç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã€‚
*   `backend/app/models.py`: å…±æœ‰Pydanticãƒ¢ãƒ‡ãƒ«å®šç¾©ã€‚
*   `backend/experiments/`: å®Ÿé¨“ç”¨ã‚³ãƒ¼ãƒ‰ç½®ãå ´ (CrewAIãªã©)ã€‚
*   `frontend/src/index.css`: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ã¨ã‚«ãƒ©ãƒ¼å¤‰æ•°å®šç¾©ã€‚
*   `vercel.json`: ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã€‚
*   `frontend/vite.config.js`: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ãƒ»é–‹ç™ºãƒ—ãƒ­ã‚­ã‚·è¨­å®šã€‚

---

### 3.3 è©³ç´°è¨­è¨ˆå›³ (Detailed Design Diagrams)

#### 3.3.1 E-Rå›³ (Entity-Relationship Diagram)
```mermaid
erDiagram
    GAMES {
        bigint id PK
        text slug UK
        text title
        text title_ja
        text title_en
        text description
        text summary
        text rules_content
        jsonb structured_data
        text image_url
        text official_url
        text amazon_url
        int min_players
        int max_players
        int play_time
        int min_age
        int published_year
        timestamp created_at
        timestamp updated_at
    }

    PROFILES {
        uuid id PK "FK -> auth.users.id"
        text username UK
        text avatar_url
        timestamp updated_at
    }

    USER_GAMES {
        uuid id PK
        uuid user_id FK "-> profiles.id"
        uuid game_id FK "-> games.id"
        text status "owned, wishlist, played"
        int rating
        text comment
        timestamp created_at
        timestamp updated_at
    }

    PROFILES ||--o{ USER_GAMES : "has"
    GAMES ||--o{ USER_GAMES : "is_listed_in"
```
> **å‡¡ä¾‹**:
> *   **PK (Primary Key)**: ä¸»ã‚­ãƒ¼ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ„ã«è­˜åˆ¥ã™ã‚‹ãŸã‚ã®IDã€‚
> *   **UK (Unique Key)**: ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã€‚é‡è¤‡ã‚’è¨±ã•ãªã„é …ç›®ï¼ˆURLã‚¹ãƒ©ãƒƒã‚°ãªã©ï¼‰ã€‚
> *   **FK (Foreign Key)**: å¤–éƒ¨ã‚­ãƒ¼ã€‚ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã®é–¢é€£ã€‚

#### 3.3.2 æ¤œç´¢ãƒ»ç”Ÿæˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹ (Search & Generation Sequence)
```mermaid
sequenceDiagram
    participant User as Client (Browser)
    participant API as Backend (FastAPI)
    participant DB as Supabase (DB)
    participant AI as Gemini (LLM)

    User->>API: POST /api/search {query}
    
    API->>DB: Select * FROM games WHERE title LIKE query
    
    alt Game Found (Cache Hit)
        DB-->>API: Game Record
        API-->>User: Return JSON
    else Game Not Found (Cache Miss)
        API->>AI: Generate Game Info (1-shot)
        AI-->>API: Structured JSON
        
        par Async Save
            API->>DB: Upsert Game Data
        and Return Response
            API-->>User: Return JSON
        end
    end
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒªãƒ³ã‚° (Data Modeling)

**Platform**: Supabase (PostgreSQL)

### 4.1 ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾© (`games`)
`backend/init_db.sql` ã«åŸºã¥ãç¾åœ¨ã®å®šç¾©ã§ã™ã€‚

```sql
-- pgvectoræ‹¡å¼µ (å°†æ¥çš„ãªãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ç”¨)
create extension if not exists vector;

create table if not exists games (
  id uuid primary key default gen_random_uuid(), -- UUID
  slug text unique,                 -- URLç”¨ã‚¹ãƒ©ãƒƒã‚°
  title text not null,              -- ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ« (æ—¥/è‹±)
  description text,                 -- çŸ­ã„æ¦‚è¦
  summary text,                     -- AIç”Ÿæˆè¦ç´„
  rules_content text,               -- è©³ç´°ãƒ«ãƒ¼ãƒ« (Markdown)
  rules jsonb default '{}'::jsonb,  -- æ§‹é€ åŒ–ãƒ«ãƒ¼ãƒ« (Legacy)
  source_url text,                  -- æƒ…å ±æºURL
  image_url text,                   -- ç”»åƒURL
  structured_data jsonb,            -- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
  
  -- Analytics & Logic
  view_count bigint default 0,      -- é–²è¦§æ•°
  search_count bigint default 0,    -- æ¤œç´¢ãƒ’ãƒƒãƒˆæ•°
  data_version integer default 0,   -- ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µãƒãƒ¼ã‚¸ãƒ§ãƒ³
  is_official boolean default false,-- å…¬å¼/æ¤œè¨¼æ¸ˆã¿ãƒ•ãƒ©ã‚°

  -- Metadata
  min_players integer,
  max_players integer,
  play_time integer,
  min_age integer,
  published_year integer,

  -- Titles
  title_ja text,
  title_en text,

  -- External Links
  official_url text,
  bgg_url text,
  bga_url text,
  amazon_url text,

  -- Media
  audio_url text,

  created_at timestamp with time zone default now() not null,
  updated_at timestamp with time zone default now() not null
);

create index if not exists idx_games_slug on games(slug);
create index if not exists idx_games_title on games(title);
```

### 4.2 ãƒˆãƒªã‚¬ãƒ¼ (Triggers)
`extensions.moddatetime` ã‚’ä½¿ç”¨ã—ã¦ä¿¡é ¼æ€§ã®é«˜ã„æ›´æ–°æ—¥æ™‚ç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚

---

## 5. è¨­å®šå€¤ãƒ»ç’°å¢ƒå¤‰æ•° (Settings & Configurations)

### 5.1 ç’°å¢ƒå¤‰æ•° (`backend/app/core/settings.py`)
ã‚·ã‚¹ãƒ†ãƒ ãŒä¾å­˜ã™ã‚‹å…¨ã¦ã®ç’°å¢ƒå¤‰æ•°ã§ã™ã€‚

| å¤‰æ•°å | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
| :--- | :--- | :--- |
| `GEMINI_API_KEY` | `None` (Required) | Google AI Studio APIã‚­ãƒ¼ã€‚ |
| `GEMINI_MODEL` | `models/gemini-2.5-flash` | ä½¿ç”¨ã™ã‚‹AIãƒ¢ãƒ‡ãƒ«åã€‚ |
| `SUPABASE_URL` | `None` (Required) | Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURLã€‚ |
| `SUPABASE_KEY` | `None` (Required) | Supabase APIã‚­ãƒ¼ã€‚ |
| `AMAZON_TRACKING_ID` | `None` | Amazonã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°IDã€‚ |

### 5.2 å®šæ•°å€¤ (Hardcoded Constants)
*   `gemini_client.py`: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ `60.0` ç§’ã€‚
*   `search.py`: "Simple Search" åˆ¤å®šã®æ–‡å­—æ•°åˆ¶é™ `50` æ–‡å­—ã€‚
*   `data_enhancer.py`: ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ `30` æ—¥, æ¤œè¨¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ `30.0` ç§’ã€‚

---

## 6. AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¨é›† (Prompt Registry)

ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ `backend/app/core/prompts_data.py` ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚

### 6.1 æ–°è¦æ¤œç´¢ãƒ»åŸºæœ¬æƒ…å ±æŠ½å‡º (`gemini_client.extract_game_info`)
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’æ¤œç´¢ã—ãŸéš›ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚å³å¯†ãªäº‹å®Ÿã«åŸºã¥ãã€ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’å›é¿ã™ã‚‹ã‚ˆã†æŒ‡ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

### 6.2 ãƒªãƒ³ã‚¯æ¤œè¨¼ãƒ»æ›´æ–° (`data_enhancer.find_valid_links`)
`DataEnhancer` ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚‹éš›ã€å…¬å¼URLã€Amazon URLã€ç”»åƒURLã®å€™è£œã‚’æ¢ã™ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

---

## 7. APIä»•æ§˜æ›¸ (API Specification)

ã™ã¹ã¦ã®APIã¯ `FastAPI` ã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã€`/api` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’æŒã¡ã¾ã™ã€‚

### 7.1 POST `/api/search`
æ¤œç´¢ã¨ç”Ÿæˆã®ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**Request**:
```json
{
  "query": "ã‚«ã‚¿ãƒ³"
}
```

**Response (SearchResult)**:
```json
{
  "id": "a0eebc99...",
  "slug": "catan",
  "title": "Catan (ã‚«ã‚¿ãƒ³)",
  "description": "...",
  "rules_content": "...",
  "structured_data": { ... }
}
```

### 7.2 GET `/api/games`
æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸã‚²ãƒ¼ãƒ ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

### 7.3 GET `/api/games/{slug}`
ç‰¹å®šã®ã‚²ãƒ¼ãƒ è©³ç´°ã‚’å–å¾—ã€‚Slug ã¾ãŸã¯ ID ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚
**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†**: `DataEnhancer` ãŒèµ·å‹•ã—ã€ãƒªãƒ³ã‚¯æƒ…å ±ã®æ¤œè¨¼ã¨æ›´æ–°ã‚’éåŒæœŸã§è©¦ã¿ã¾ã™ã€‚

---

## 8. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è©³ç´° (Frontend Details)

**Framework**: React 18 + Vite
**Styling**: CSS Modules (Variables) + Utility Classes

### 8.1 ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ  (Design System)
`frontend/src/index.css` ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ç¾åœ¨ã®CSSå¤‰æ•°ã§ã™ã€‚

```css
:root {
  --bg-dark: #0b1221;
  --bg-card: rgba(255, 255, 255, 0.05);
  --accent: #4ef0c7;
  --text-main: #eef2ff;
  --font-main: 'Zen Maru Gothic', sans-serif;
  --font-head: 'Space Grotesk', sans-serif;
}
```

---

## 9. é–‹ç™ºç’°å¢ƒã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼ (Development Environment & Deploy Flow)

### 9.1 ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰

**ä¾å­˜é–¢ä¿‚ (Dependencies)**:
*   **Backend**: `fastapi`, `google-generativeai`, `supabase`, `httpx`, `PyYAML`
*   **Frontend**: `react`, `react-markdown`

**ã‚³ãƒãƒ³ãƒ‰ (Taskfile)**:
*   `task dev`: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹• (Backend + Frontend)
*   `task lint`: Lint & Format

### 9.2 å®Ÿé¨“çš„æ©Ÿèƒ½ã®é–‹ç™º (Experiments)
CrewAIãªã©ã®æ–°ã—ã„AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è©¦ã™å ´åˆã¯ã€å¿…ãš `backend/experiments/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§é–‹ç™ºã—ã¦ãã ã•ã„ã€‚
`backend/app/` å†…ã®ã‚³ãƒ¼ãƒ‰ã¯æœ¬ç•ªç”¨ã§ã‚ã‚Šã€å®Ÿé¨“çš„ãªä¾å­˜é–¢ä¿‚ã‚’å«ã‚ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

### 9.3 ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ (Coding Standards)
*   **KISS**: ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¤ã€‚
*   **No Comments**: ã‚³ãƒ¼ãƒ‰ã§èªã‚‹ã€‚
*   **Japanese Content**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ†ã‚­ã‚¹ãƒˆã¯æ—¥æœ¬èªã€‚
*   **Type Hints**: Pythonã‚³ãƒ¼ãƒ‰ã«ã¯å‹ãƒ’ãƒ³ãƒˆã‚’å¿…é ˆã¨ã™ã‚‹ã€‚
*   **Prompts in Python**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ `prompts_data.py` ã«è¨˜è¿°ã™ã‚‹ (Verceläº’æ›æ€§ã®ãŸã‚)ã€‚

---

## 10. éšœå®³ç®¡ç† (Failure Management)

### 10.1 Vercelç’°å¢ƒå¤‰æ•°
`echo -n` ã‚’ä½¿ç”¨ã—ã¦æ”¹è¡Œã‚’å«ã‚ãšã«è¨­å®šã™ã‚‹ã“ã¨ã€‚

### 10.2 IDã®å‹å®šç¾©
Supabaseã®IDã¯ **UUID (str)** ã§ã™ã€‚`int` ã¨ã—ã¦æ‰±ã‚ãªã„ã“ã¨ã€‚

### 10.3 Supabase Upsert
å¿…ãšãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ã§ã‚«ãƒ©ãƒ ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã‹ã‚‰ `upsert` ã™ã‚‹ã“ã¨ã€‚AIãŒç”Ÿæˆã—ãŸä½™åˆ†ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

---

## 11. ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ  (Affiliate System)

### 11.1 è‡ªå‹•æ¤œç´¢ãƒªãƒ³ã‚¯ (Layer 0)
*   **ãƒ­ã‚¸ãƒƒã‚¯**: `https://www.amazon.co.jp/s?k={Title}&tag={TrackingID}` ã‚’è‡ªå‹•ç”Ÿæˆã€‚
*   **å®Ÿè£…**: `backend/app/services/amazon_affiliate.py`
*   **å„ªå…ˆé †ä½**: `structured_data` ã«æ˜ç¤ºçš„ãªãƒªãƒ³ã‚¯ãŒãªã„å ´åˆã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚

### 11.2 æ¤œè¨¼æ¸ˆã¿ãƒªãƒ³ã‚¯ (Layer 1 - DataEnhancer)
*   **ãƒ­ã‚¸ãƒƒã‚¯**: `DataEnhancer` ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ‰åŠ¹ãªAmazonå•†å“ãƒšãƒ¼ã‚¸URLã‚’ç‰¹å®šã—ã€DBã«ä¿å­˜ã€‚
*   **å®Ÿè£…**: `backend/app/services/data_enhancer.py`
*   **å„ªå…ˆé †ä½**: æœ€å„ªå…ˆã€‚DBã« `amazon_url` ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€‚

---

ã“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å‚è€ƒã«ã—ã¦ã€ã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤é«˜é€Ÿãªã€Œãƒœãƒ‰ã‚²ã®ãƒŸã‚«ã‚¿ã€ã‚’é–‹ç™ºã—ç¶šã‘ã¾ã—ã‚‡ã†ã€‚

---

## 12. SEOã¨æ¤œè¨¼ (SEO & Validation)

### 12.1 Google Search Console Verification
*   **Method**: HTML File Upload
*   **File**: `frontend/public/google0e9954154a369dd5.html`
*   **Content**: `google-site-verification: google0e9954154a369dd5.html`
*   **Purpose**: Google Search Console ã®æ‰€æœ‰æ¨©ç¢ºèªç”¨ã€‚

### 12.2 Meta Tags & Indexability
*   **Robots Meta Tag**: `frontend/index.html` ã« `<meta name="robots" content="index, follow" />` ã‚’é…ç½®ã—ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨±å¯ã€‚
*   **Dynamic Meta Tags**: `react-helmet-async` ã‚’ä½¿ç”¨ã—ã¦ã€å„ã‚²ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ (`GamePage.jsx`) ã§å‹•çš„ã« `<title>`, `<meta name="description">`, OGPã‚¿ã‚°ã‚’ç”Ÿæˆã€‚
*   **Canonical URL**: é‡è¤‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é˜²æ­¢ã®ãŸã‚ã€æ­£è¦åŒ–URLã‚’è¨­å®šã€‚

### 12.3 Sitemap & Robots.txt
*   **Sitemap**: `frontend/public/sitemap.xml` (æ‰‹å‹•/é™çš„é…ç½®)
*   **Robots.txt**: `frontend/public/robots.txt`

---

## 13. æ–°æ©Ÿèƒ½è©³ç´° (New Features Specification)

### 13.1 éŸ³å£°è§£èª¬æ©Ÿèƒ½ (Audio Explanation)
*   **ç›®çš„**: è¦–è¦šã ã‘ã§ãªãè´è¦šã§ã‚‚ãƒ«ãƒ¼ãƒ«ã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼‰ã€‚
*   **æŠ€è¡“**: Browser Native `SpeechSynthesis` API (Web Speech API)ã€‚
    *   **Backendä¸è¦**: ã‚µãƒ¼ãƒãƒ¼è² è·ã‚¼ãƒ­ã€ã‚³ã‚¹ãƒˆã‚¼ãƒ­ã€‚
    *   **Offlineå¯¾å¿œ**: ãƒ–ãƒ©ã‚¦ã‚¶ã®æ©Ÿèƒ½ã«ä¾å­˜ã™ã‚‹ãŸã‚ã€ä¸€éƒ¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚å‹•ä½œå¯èƒ½ã€‚
*   **å®Ÿè£…**: `frontend/src/pages/GamePage.jsx` å†…ã® `TextToSpeech` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚
*   **æŒ™å‹•**:
    *   ã€ŒğŸ”Šã€ãƒœã‚¿ãƒ³ã§ `game.summary` (è¦ç´„) ã‚’èª­ã¿ä¸Šã’é–‹å§‹ã€‚
    *   ã€Œâ¹ï¸ã€ãƒœã‚¿ãƒ³ã§åœæ­¢ã€‚
    *   æ—¥æœ¬èªéŸ³å£° (`ja-JP`) ã‚’è‡ªå‹•é¸æŠã€‚

### 13.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† & ãƒªã‚¹ãƒˆæ©Ÿèƒ½ (User Management)
*   **ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ŒæŒã£ã¦ã„ã‚‹ã‚²ãƒ¼ãƒ ã€ã€Œæ¬²ã—ã„ã‚²ãƒ¼ãƒ ã€ã‚’ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
*   **èªè¨¼**: Supabase Auth (Email, Googleäºˆå®š)ã€‚
*   **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ**:
    *   `profiles`: ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬æƒ…å ±ã€‚`auth.users` ã¨1å¯¾1ã§åŒæœŸï¼ˆTriggerä½¿ç”¨ï¼‰ã€‚
    *   `user_games`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚²ãƒ¼ãƒ ã®å¤šå¯¾å¤šé–¢ä¿‚ã€‚
        *   `status`: 'owned' (æ‰€æŒ), 'wishlist' (æ¬²ã—ã„), 'played' (ãƒ—ãƒ¬ã‚¤æ¸ˆã¿)ã€‚
        *   `rating`: 1-10ã®è©•ä¾¡ã€‚
        *   `comment`: å€‹åˆ¥ãƒ¡ãƒ¢ã€‚
*   **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: RLS (Row Level Security) ã«ã‚ˆã‚Šã€ä»–äººã®ãƒ‡ãƒ¼ã‚¿ã¯é–²è¦§ã®ã¿è¨±å¯ã€æ›´æ–°ã¯æœ¬äººã®ã¿ã€‚

### 13.3 ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚·ã‚§ã‚¢ (Social Sharing)
*   **Twitter (X)**:
    *   ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ³ãƒ†ãƒ³ãƒˆURLã‚’ä½¿ç”¨: `https://twitter.com/intent/tweet`
    *   ãƒ†ã‚­ã‚¹ãƒˆ: `ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã€Œ{title}ã€ãŒã‚¢ãƒ„ã„ï¼ä»Šã™ããƒã‚§ãƒƒã‚¯ï¼`
    *   ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°: `#ãƒœãƒ‰ã‚²ã®ãƒŸã‚«ã‚¿`
*   **Copy Link**: ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIã‚’ä½¿ç”¨ã€‚éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ã‚ã‚Šã€‚

---

## 14. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°æˆ¦ç•¥ (Prompt Engineering)

### 14.1 æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®é€²åŒ–
åˆæœŸã® `popular_cards` (ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ é™å®š) ã‹ã‚‰ã€ã‚ˆã‚Šæ±ç”¨çš„ãª `key_elements` ã¸ç§»è¡Œã—ã¾ã—ãŸã€‚

*   **Key Elements**:
    *   **Type**: Card, Tile, Board, Token, Power Plant, Meeple ãªã©ã€‚
    *   **Reason**: å˜ãªã‚‹æ©Ÿèƒ½èª¬æ˜ã§ã¯ãªãã€ã€Œãªãœãã‚ŒãŒé¢ç™½ã„ã®ã‹ï¼ˆCharmï¼‰ã€ã‚’å«ã‚ã‚‹ã‚ˆã†AIã«æŒ‡ç¤ºã€‚

### 14.2 Markdownãƒ«ãƒ¼ãƒ«ã®å¼·åˆ¶
`rules_content` ã¯å˜ãªã‚‹ãƒ†ã‚­ã‚¹ãƒˆã§ã¯ãªãã€ä»¥ä¸‹ã®ãƒ˜ãƒƒãƒ€ãƒ¼æ§‹é€ ã‚’æŒã¤Markdownã¨ã—ã¦ç”Ÿæˆã•ã‚Œã¾ã™ã€‚
1.  `## Setup` (æº–å‚™)
2.  `## Gameplay` (ã‚²ãƒ¼ãƒ ã®æµã‚Œ)
3.  `## End Game` (çµ‚äº†æ¡ä»¶ãƒ»å‹åˆ©æ¡ä»¶)

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®å¯èª­æ€§ãŒå‘ä¸Šã—ã€å°†æ¥çš„ã«ã¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³è¡¨ç¤ºãªã©ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

---

## 15. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥ (Deployment Strategy)

### 15.1 Vercel Configuration
*   **Framework Preset**: Vite (Frontend), Python (Backend).
*   **Configuration File**: `vercel.json`
    *   **Rewrites**: `/api/*` ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ `backend/app/main.py` ã¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€‚
    *   **SPA Fallback**: ãã®ä»–ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ `frontend/index.html` ã¸ã€‚

### 15.2 Environment Variables (Production)
æœ¬ç•ªç’°å¢ƒ (Vercel) ã§ã¯ã€ä»¥ä¸‹ã®å¤‰æ•°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
*   `GEMINI_API_KEY`: æœ¬ç•ªç”¨ã®Google AI Studioã‚­ãƒ¼ã€‚
*   `SUPABASE_URL`: æœ¬ç•ªSupabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURLã€‚
*   `SUPABASE_KEY`: `service_role` ã‚­ãƒ¼ã§ã¯ãªãã€**`anon` ã‚­ãƒ¼**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ï¼ˆRLSã§ä¿è­·ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼‰ã€‚ãŸã ã—ã€Backendå‡¦ç†ã§ç‰¹æ¨©ãŒå¿…è¦ãªå ´åˆã¯ `service_role` ã‚’æ¤œè¨ã™ã‚‹ãŒã€ç¾åœ¨ã¯ `anon` ã§ååˆ†ã€‚
*   `AMAZON_TRACKING_ID`: æœ¬ç•ªç”¨ã®ã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆIDã€‚

### 15.3 CI/CD Flow
1.  **GitHub Push**: `main` ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‚’ãƒˆãƒªã‚¬ãƒ¼ã€‚
2.  **Vercel Build**:
    *   Frontend: `npm install && npm run build`
    *   Backend: `pip install -r requirements.txt`
3.  **Deploy**: è‡ªå‹•çš„ã«Edge Networkã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚

---

## 16. å°†æ¥ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— (Future Roadmap)

### 16.1 ãƒ•ã‚§ãƒ¼ã‚º 2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ (Current)
*   **Google Login (Issue #61)**: ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ­ã‚°ã‚¤ãƒ³ã€‚
*   **Like / Favorite (Issue #62)**: å€‹åˆ¥ã®ã‚²ãƒ¼ãƒ ã«ã€Œã„ã„ã­ã€ã‚’ã¤ã‘ã‚‹æ©Ÿèƒ½ã€‚
*   **Lists (Issue #59, #60)**:
    *   ã€ŒæŒã£ã¦ã„ã‚‹ (Owned)ã€
    *   ã€ŒéŠã³ãŸã„ (Wishlist)ã€
    *   ã€ŒéŠã‚“ã  (Played)ã€
    *   ã“ã‚Œã‚‰ã‚’ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ç®¡ç†ãƒ»å…¬é–‹ã€‚

### 16.2 ãƒ•ã‚§ãƒ¼ã‚º 3: ã‚½ãƒ¼ã‚·ãƒ£ãƒ« & ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£
*   **Review & Rating**: æ˜Ÿè©•ä¾¡ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‚
*   **Follow User**: ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ï¼ˆã€Œã€‡ã€‡ã‚’è²·ã£ãŸï¼ã€ï¼‰ã‚’ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§è¡¨ç¤ºã€‚
*   **Share Lists**: ã€Œç§ã®ãƒ™ã‚¹ãƒˆ10ã€ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦SNSã§ã‚·ã‚§ã‚¢ã€‚

### 16.3 ãƒ•ã‚§ãƒ¼ã‚º 4: é«˜åº¦ãªAIæ©Ÿèƒ½
*   **Rule Q&A Chatbot**: ã€Œã“ã®ã‚«ãƒ¼ãƒ‰ã€æ‰‹æœ­ãŒ0æšã®ã¨ãä½¿ãˆã‚‹ï¼Ÿã€ã¨ã„ã£ãŸå…·ä½“çš„ãªè³ªå•ã«ç­”ãˆã‚‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã€‚
*   **Recommendation**: ã€Œã‚«ã‚¿ãƒ³ãŒå¥½ããªã‚‰ã€æ¬¡ã¯ã“ã‚ŒãŒãŠã™ã™ã‚ã€ã¨ã„ã†AIãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã€‚

---

## 17. ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ (Service Management)

### 17.1 API Rate Limits (Gemini)
*   **ç¾çŠ¶**: Gemini 2.5 Flash Free Tier ã‚’ä½¿ç”¨ã€‚
*   **åˆ¶é™**: 1åˆ†ã‚ãŸã‚Š15ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (RPM)ã€1æ—¥ã‚ãŸã‚Š1,500ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (RPD)ã€‚
*   **å¯¾ç­–**:
    *   **Caching**: `Cache-Control` ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚ˆã‚Šã€CDNã¨ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ€å¤§åŒ–ã€‚
    *   **Database First**: å¿…ãšSupabaseã‚’å…ˆã«æ¤œç´¢ã—ã€å­˜åœ¨ã—ãªã„å ´åˆã®ã¿ç”Ÿæˆã€‚
    *   **Availability (å¯ç”¨æ€§)**: 429ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œç¾åœ¨æ··ã¿åˆã£ã¦ã„ã¾ã™ã€ã¨è¡¨ç¤ºã—ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ãƒ€ã‚¦ãƒ³ã‚’é˜²ãï¼ˆç¸®é€€é‹è»¢ï¼‰ã€‚

### 17.2 ãƒ­ã‚°ç›£è¦–
*   **Backend Logs**: Vercel Dashboardã® "Logs" ã‚¿ãƒ–ã§ç¢ºèªã€‚
*   **Client Errors**: ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŠã‚ˆã³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ç¢ºèªã€‚
*   **Critical Errors**: 500ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ç›´ã¡ã« `backend.log` (ãƒ­ãƒ¼ã‚«ãƒ«) ã¾ãŸã¯ Vercel Logs ã‚’ç¢ºèªã—ã€ä¿®æ­£ãƒ‘ãƒƒãƒã‚’é©ç”¨ã€‚

### 17.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
*   **Backup Strategy**: Supabaseã®PITR (Point-in-Time Recovery) æ©Ÿèƒ½ã«ä¾å­˜ã€‚
*   å¤§è¦æ¨¡ãªã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´å‰ã«ã¯ã€æ‰‹å‹•ã§SQLãƒ€ãƒ³ãƒ—ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã€‚
